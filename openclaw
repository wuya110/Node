cat << 'EOF' > openclaw_master.sh
#!/bin/bash

GREEN="\033[32m"
RED="\033[31m"
YELLOW="\033[33m"
CYAN="\033[36m"
RESET="\033[0m"

# 1. ç³»ç»Ÿå¤§å±çœ‹æ¿
function show_dashboard() {
    clear
    echo -e "${CYAN}===================================================${RESET}"
    echo -e "${CYAN}             ç³»ç»ŸçŠ¶æ€ä¸ AI é˜µå®¹å¤§å±                ${RESET}"
    echo -e "${CYAN}===================================================${RESET}"
    
    echo -e "\n${YELLOW}â–¶ å½“å‰å·²åŠ è½½çš„æä¾›å•† (Providers) åˆ—è¡¨ï¼š${RESET}"
    openclaw models | grep -E "^\- |Configured" || echo "æš‚æ— æ•°æ®æˆ–ç½‘å…³æœªå¯åŠ¨"
    
    echo -e "\n${YELLOW}â–¶ å½“å‰æ­£åœ¨æœå½¹çš„ä¸»åŠ›æ¨¡å‹ä¸ç½‘å…³çŠ¶æ€ï¼š${RESET}"
    openclaw status | grep -E "Gateway|Agents|Sessions|model" || echo "çŠ¶æ€è·å–å¤±è´¥"
    
    echo -e "\n${GREEN}===================================================${RESET}"
    read -p "çœ‹å®Œå•¦ï¼æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•..."
}

# 2. ä¸­è½¬ä¸“çº¿é…ç½®å‘å¯¼ (å¸¦æ’¤å›æœºåˆ¶)
function add_provider_wizard() {
    while true; do
        clear
        echo -e "${CYAN}===================================================${RESET}"
        echo -e "${CYAN}      ä¸­è½¬ä¸“çº¿é…ç½®å‘å¯¼ (å¸¦æ’¤å›é˜²é”™æœºåˆ¶)            ${RESET}"
        echo -e "${CYAN}===================================================${RESET}"
        echo -e "ğŸ’¡ æç¤ºï¼šåœ¨ä»»ä½•ä¸€æ­¥è¾“å…¥ ${RED}q${RESET} å¹¶å›è½¦ï¼Œå‡å¯ç«‹å³æ’¤å›å¹¶ä¸­æ–­æ“ä½œã€‚\n"
        
        # ç¬¬ä¸€æ­¥ï¼šä»£å·
        echo -e "${YELLOW}[1/4] æä¾›å•†ä»£å· (ä¹Ÿå°±æ˜¯è¿™ä¸ªä¸­è½¬ç«™çš„â€œåº—åâ€)${RESET}"
        read -p "è¯·èµ·ä¸ªå…¨è‹±æ–‡ä»£å· (å¦‚ tao, deepseek, myapi): " p
        if [[ "${p,,}" == "q" || -z "$p" ]]; then echo -e "${RED}æ“ä½œå·²æ’¤å›ï¼${RESET}"; sleep 1; return; fi
        echo ""
        
        # ç¬¬äºŒæ­¥ï¼šKey
        echo -e "${YELLOW}[2/4] API Key${RESET}"
        read -p "è¯·è¾“å…¥å•†å®¶çš„ API Key (sk-...): " k
        if [[ "${k,,}" == "q" || -z "$k" ]]; then echo -e "${RED}æ“ä½œå·²æ’¤å›ï¼${RESET}"; sleep 1; return; fi
        echo ""
        
        # ç¬¬ä¸‰æ­¥ï¼šURL
        echo -e "${YELLOW}[3/4] ä¸­è½¬æ¥å£ URL${RESET}"
        read -p "è¯·è¾“å…¥è¯·æ±‚åœ°å€ (å¿…é¡»å« /v1ï¼Œå¦‚ https://tao.plus7.plus/v1): " u
        if [[ "${u,,}" == "q" || -z "$u" ]]; then echo -e "${RED}æ“ä½œå·²æ’¤å›ï¼${RESET}"; sleep 1; return; fi
        echo ""
        
        # ç¬¬å››æ­¥ï¼šæ¨¡å‹
        echo -e "${YELLOW}[4/4] é»˜è®¤æ¨¡å‹${RESET}"
        read -p "è¯·è¾“å…¥é»˜è®¤ä½¿ç”¨çš„æ¨¡å‹ (å¦‚ gpt-4o, gpt-5): " m
        if [[ "${m,,}" == "q" || -z "$m" ]]; then echo -e "${RED}æ“ä½œå·²æ’¤å›ï¼${RESET}"; sleep 1; return; fi
        
        # æœ€ç»ˆç¡®è®¤å¤§å±
        clear
        echo -e "${GREEN}>>> è¯·åšæœ€åç¡®è®¤ (æ­¤æ—¶ä»å¯æ’¤å›) <<<${RESET}"
        echo -e "---------------------------------------------------"
        echo -e " æä¾›å•†ä»£å· : ${CYAN}$p${RESET}"
        echo -e " API Key    : ${CYAN}$k${RESET}"
        echo -e " è¯·æ±‚åœ°å€   : ${CYAN}$u${RESET}"
        echo -e " é»˜è®¤æ¨¡å‹   : ${CYAN}$m${RESET}"
        echo -e "---------------------------------------------------"
        read -p "ç¡®è®¤æ— è¯¯å¹¶å†™å…¥ç³»ç»Ÿå—ï¼Ÿ(è¾“å…¥ y ç¡®è®¤ï¼Œå…¶ä»–ä»»æ„é”®æ’¤å›): " confirm
        if [[ "${confirm,,}" != "y" ]]; then 
            echo -e "${RED}å·²è§¦å‘æ’¤å›ä¿æŠ¤ï¼Œæœªå¯¹ç³»ç»Ÿåšä»»ä½•ä¿®æ”¹ï¼${RESET}"
            sleep 1; return
        fi
        
        echo -e "\n${YELLOW}æ­£åœ¨å¼ºè¡Œæ³¨å…¥ç³»ç»Ÿ...${RESET}"
        PAYLOAD="{\"baseUrl\":\"$u\",\"apiKey\":\"$k\",\"models\":[{\"id\":\"$m\",\"name\":\"$m\"}]}"
        openclaw config set "models.providers.$p" --json "$PAYLOAD"
        
        echo -e "${YELLOW}æ­£åœ¨å°†ä¸»æ¨¡å‹åˆ‡æ¢ä¸º $p/$m ...${RESET}"
        openclaw config set agents.defaults.model.primary "$p/$m"
        
        echo -e "${GREEN}é…ç½®å·²å®‰å…¨å†™å…¥ï¼æ­£åœ¨é‡å¯ç½‘å…³ä½¿é…ç½®ç”Ÿæ•ˆ...${RESET}"
        systemctl --user restart openclaw-gateway
        read -p "æ“ä½œæˆåŠŸï¼æ‚¨çš„æ–°æ¨¡å‹å·²ä¸Šçº¿ã€‚æŒ‰å›è½¦é”®è¿”å›..."
        return
    done
}

# 3. æ·»åŠ  AI çš„åˆ†æ”¯èœå•
function add_ai_menu() {
    while true; do
        clear
        echo -e "${CYAN}===================================================${RESET}"
        echo -e "${CYAN}              è¯·é€‰æ‹©æ·»åŠ  AI æ¨¡å‹çš„æ–¹å¼             ${RESET}"
        echo -e "${CYAN}===================================================${RESET}"
        echo -e "${YELLOW}  1.${RESET} ä½¿ç”¨ç³»ç»Ÿå®˜æ–¹è‡ªå¸¦å‘å¯¼ (é€‚åˆå®˜æ–¹é»˜è®¤é…ç½®)"
        echo -e "${YELLOW}  2.${RESET} ä½¿ç”¨è‡ªå®šä¹‰ä¸­è½¬å‘å¯¼ (ä¿å§†çº§é˜²é”™ï¼Œé€‚åˆç¬¬ä¸‰æ–¹èŠ‚ç‚¹)"
        echo -e ""
        echo -e "${YELLOW}  0.${RESET} è¿”å›ä¸Šçº§ä¸»èœå•"
        echo -e "${CYAN}===================================================${RESET}"
        read -p "è¯·è¾“å…¥é€‰é¡¹ (0-2): " sub_choice

        case $sub_choice in
            1) clear; echo -e "${GREEN}>>> æ­£åœ¨å”¤èµ·å®˜æ–¹é…ç½®å‘å¯¼...${RESET}"; openclaw configure; read -p "å®˜æ–¹å‘å¯¼ç»“æŸã€‚æŒ‰å›è½¦é”®è¿”å›...";;
            2) add_provider_wizard ;;
            0) return ;;
            *) echo -e "${RED}æ— æ•ˆè¾“å…¥ï¼${RESET}"; sleep 1 ;;
        esac
    done
}

# 4. æ ¸å¿ƒç¯å¢ƒå®‰è£… (å¤åŸåŠŸèƒ½)
function install_core() {
    clear
    echo -e "${RED}>>> è­¦å‘Šï¼šå³å°†å¼€å§‹å®‰è£…å…¨æ–°ç¯å¢ƒï¼${RESET}"
    read -p "å¦‚æœæ‚¨å·²å®‰è£… OpenClawï¼Œè¯·ä¸è¦æ‰§è¡Œæ­¤æ“ä½œï¼æŒ‰å›è½¦é”®ç»§ç»­ï¼Œæˆ–è¾“å…¥ q å–æ¶ˆ: " confirm
    if [[ "${confirm,,}" == "q" ]]; then return; fi
    
    echo -e "${GREEN}>>> [1/3] æ›´æ–°ç³»ç»Ÿä¸å®‰è£…åŸºç¡€ä¾èµ–...${RESET}"
    apt update -y && apt install -y curl wget jq
    curl -fsSL https://deb.nodesource.com/setup_current.x | bash -
    apt install -y nodejs
    npm install -g npm@latest
    npm install -g openclaw@latest
    echo -e "${YELLOW}ç¯å¢ƒéƒ¨ç½²å®Œæˆï¼æ‚¨å¯ä»¥é€‰æ‹©èœå•é‡Œçš„ [ç³»ç»Ÿæ€¥æ•‘] å¯åŠ¨åˆå§‹é…ç½®ã€‚${RESET}"
    read -p "æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•..."
}

# ä¸»èœå•ç•Œé¢
function show_menu() {
    while true; do
        clear
        echo -e "${GREEN}===================================================${RESET}"
        echo -e "${GREEN}      OpenClaw ç»ˆææ§åˆ¶å° (å…¸è—ä¿®å¤ç‰ˆ)             ${RESET}"
        echo -e "${GREEN}===================================================${RESET}"
        echo -e "${CYAN}[ çŠ¶æ€ç›‘æ§ ]${RESET}"
        echo -e "${YELLOW}  1.${RESET} æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¤§å± (å·²åŠ æ¨¡å‹ / å½“å‰è¿è¡Œæ¨¡å‹)"
        echo -e ""
        echo -e "${CYAN}[ æ ¸å¿ƒæ¨¡å‹ç®¡ç† ]${RESET}"
        echo -e "${YELLOW}  2.${RESET} æ·»åŠ  / ä¿®æ”¹ AI æ¨¡å‹ ${GREEN}(-> è¿›å…¥åŒçº¿é€‰æ‹©)${RESET}"
        echo -e "${RED}  3.${RESET} åˆ é™¤å¤±æ•ˆçš„ AI æä¾›å•† (æ¸…ç†è·‘è·¯èŠ‚ç‚¹ï¼Œå¸¦æ’¤å›)"
        echo -e ""
        echo -e "${CYAN}[ ç»´æŠ¤ä¸å®‰è£… ]${RESET}"
        echo -e "${YELLOW}  4.${RESET} è°ƒå‡ºå®˜æ–¹æ¨¡å‹ä¿¡æ¯æ¿ (ä»…æŸ¥çœ‹)"
        echo -e "${RED}  5.${RESET} ç³»ç»Ÿæ€¥æ•‘: ä¿®å¤å—æŸçš„é…ç½®ä¸ç¯å¢ƒ (Doctor Fix)"
        echo -e "${CYAN}  9.${RESET} ã€ä»é›¶å¼€å§‹ã€‘ä¸€é”®å®‰è£… Node.js ä¸ OpenClaw ç¯å¢ƒ"
        echo -e ""
        echo -e "${YELLOW}  0.${RESET} é€€å‡ºæ§åˆ¶å°"
        echo -e "${GREEN}===================================================${RESET}"
        read -p "è¯·è¾“å…¥æ•°å­—é€‰æ‹©: " choice

        case $choice in
            1) show_dashboard ;;
            2) add_ai_menu ;;
            3) 
                clear
                echo -e "${RED}>>> [ åˆ é™¤å¤±æ•ˆçš„ AI æä¾›å•† ]${RESET}"
                echo -e "æç¤ºï¼šæ‚¨å¯ä»¥ä»å¤§å±é‡Œæ‰¾åˆ°æä¾›å•†çš„åå­—ï¼ˆå¦‚ tao, openaiï¼‰ã€‚"
                read -p "è¾“å…¥è¦åˆ é™¤çš„æä¾›å•†ä»£å· [æŒ‰ q é€€å‡ºæ’¤å›]: " dp
                if [[ "${dp,,}" == "q" || -z "$dp" ]]; then echo -e "${RED}å·²æ’¤å›ï¼${RESET}"; sleep 1; continue; fi
                openclaw config unset "models.providers.$dp"
                openclaw config set agents.defaults.model.primary "openai/gpt-4o"
                echo -e "${GREEN}æ¸…ç†å®Œæˆå¹¶æ¢å¤å®˜æ–¹é»˜è®¤è®¾ç½®ã€‚æ­£åœ¨é‡å¯ç½‘å…³...${RESET}"
                systemctl --user restart openclaw-gateway
                read -p "æŒ‰å›è½¦ç»§ç»­..."
                ;;
            4) clear; openclaw models; read -p "æŒ‰å›è½¦é”®è¿”å›..." ;;
            5) 
                openclaw doctor --fix
                systemctl --user restart openclaw-gateway
                echo -e "${GREEN}ä¿®å¤æŒ‡ä»¤å·²æ‰§è¡Œï¼ç½‘å…³å·²é‡å¯ã€‚${RESET}"
                read -p "æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•..." 
                ;;
            9) install_core ;;
            0) echo -e "${GREEN}å·²é€€å‡ºã€‚éšæ—¶è¾“å…¥ bash openclaw_master.sh å”¤å‡ºèœå•ã€‚${RESET}"; exit 0 ;;
            *) echo -e "${RED}æ— æ•ˆè¾“å…¥ï¼${RESET}"; sleep 1 ;;
        esac
    done
}

show_menu
EOF
bash openclaw_master.sh
