# ==========================================
# ğŸ¦ OpenClaw ç»ˆæé˜²å¼¹æ³¨å…¥ SOP (å®æˆ˜æœ€ç»ˆæˆåŠŸç‰ˆ - AIè®°å¿†ä¸“ç”¨)
# ==========================================
# ğŸ§  ç»™æœªæ¥ AI çš„å¤‡å¿˜å½• (æ ¸å¿ƒåŸåˆ™ï¼Œç¦æ­¢è¯•é”™)ï¼š
# 1. å¿…é¡»å…ˆ `cat` æ£€æŸ¥åŸæ–‡ä»¶ï¼Œç¡®è®¤ç”¨æˆ·çš„åŸç”Ÿæ ¼å¼ï¼ˆå•è¡Œç´§å‡‘å‹ï¼‰ã€‚
# 2. æ³¨å…¥æ—¶å¿…é¡»ä½¿ç”¨ã€å•è¡Œç´§å‡‘æ ¼å¼ (Compact JSON)ã€‘ï¼Œå½»åº•æœç» SSH ç²˜è´´æ—¶çš„æ¢è¡Œ/ç¼©è¿›ä¸¢å¤±å¯¼è‡´ SyntaxErrorã€‚
# 3. å¿…é¡»ä½¿ç”¨ `cat << 'EOF'`ï¼ˆå¸¦å•å¼•å·ï¼‰ï¼Œé˜²æ­¢ Shell è½¬ä¹‰ API Key ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚
# 4. å†™å…¥åå¿…é¡»ä½¿ç”¨ `chattr +i` ç‰©ç†é”å®šï¼Œé˜²æ­¢ OpenClaw ç³»ç»Ÿè‡ªæ„ˆç¨‹åº (Doctor) è‡ªåŠ¨é‡ç½®æ–‡ä»¶ã€‚
# 5. å¿…é¡»é€‰æ‹©æ”¯æŒ Function Calling çš„æ¨¡å‹ï¼ˆå¦‚ zhipu/glm-4-flash, deepseek/deepseek-chatï¼‰ã€‚

# --- [1. ç‰©ç†åœæœºã€æ‹”é™¤ç¡¬é” & æ·±åº¦æ¸…ç†] ---
openclaw gateway stop
pkill -f openclaw
chattr -i /root/.openclaw/openclaw.json 2>/dev/null
rm -rf /root/.oopenclaw* # å¿…é¡»æ¸…ç†å› ç²˜è´´å†²çªäº§ç”Ÿçš„æ±¡æŸ“è·¯å¾„

# --- [2. å¼ºåˆ¶å¤‡ä»½ & ç°åœºå®¡è®¡] ---
cp /root/.openclaw/openclaw.json /root/.openclaw/openclaw.json.bak
echo -e "\nâš ï¸ [AI å®¡è®¡èŠ‚ç‚¹] è¯·ç¡®è®¤åŸé…ç½®æ ¼å¼æ˜¯å¦ä¸ºå•è¡Œç´§å‡‘å‹ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•æ®‹ç•™..."
cat /root/.openclaw/openclaw.json
sleep 3

# --- [3. æ ¸å¿ƒé…ç½®ç²¾å‡†æ³¨å…¥ (å•è¡Œç´§å‡‘æ ¼å¼)] ---
# æ³¨æ„ï¼šä¸‹é¢æ˜¯ä¸¥æ ¼çš„å•è¡Œç´§å‡‘ JSONï¼Œè¯·æ‰‹åŠ¨æ›¿æ¢ YOUR_DEEPSEEK_KEYã€YOUR_ZHIPU_KEY å’Œ YOUR_TG_BOT_TOKEN
cat << 'EOF' > /root/.openclaw/openclaw.json
{"auth":{"profiles":{"deepseek:default":{"provider":"openai","mode":"api_key"},"zhipu:default":{"provider":"openai","mode":"api_key"}}},"models":{"mode":"replace","providers":{"deepseek":{"baseUrl":"https://api.deepseek.com","apiKey":"YOUR_DEEPSEEK_KEY","api":"openai-completions","models":[{"id":"deepseek-chat","name":"DeepSeek-V3","contextWindow":128000}]},"zhipu":{"baseUrl":"https://open.bigmodel.cn/api/paas/v4","apiKey":"YOUR_ZHIPU_KEY","api":"openai-completions","models":[{"id":"glm-4-flash","name":"GLM-4-Flash","contextWindow":128000}]}}},"agents":{"defaults":{"model":{"primary":"zhipu/glm-4-flash"},"models":{"deepseek/deepseek-chat":{"alias":"ğŸ’ DeepSeek (ç¨³å®šå¤‡ä»½)"},"zhipu/glm-4-flash":{"alias":"ğŸ’¡ æ™ºè°± Flash (ä¸»åŠ›æµ‹è¯•)"}}}},"channels":{"telegram":{"enabled":true,"botToken":"YOUR_TG_BOT_TOKEN","dmPolicy":"pairing","groupPolicy":"allowlist","streaming":false}},"gateway":{"mode":"local"},"plugins":{"entries":{"telegram":{"enabled":true}}}}
EOF
echo "âœ… å•è¡Œç´§å‡‘æ ¼å¼é…ç½®å·²æ³¨å…¥ï¼"

# --- [4. ç‰©ç†ä¸Šé” & èŠ‚ç‚¹ç»ˆå®¡] ---
chattr +i /root/.openclaw/openclaw.json
openclaw gateway start

sleep 3
echo -e "\n--- [ æ ¸å¿ƒæ¨¡å‹èŠ‚ç‚¹å®¡è®¡ ] ---"
openclaw models list
echo "------------------------------------------------"
echo "ğŸ‘‰ æˆåŠŸæ ‡å‡†ï¼šå¿…é¡»çœ‹åˆ° zhipu ä¸º defaultï¼Œä¸”æ—  missing æ ‡ç­¾ã€‚"
echo "ğŸ‘‰ ç¡®è®¤æ— è¯¯åï¼Œå‰å¾€ Telegram å‘é€ /reset æ¿€æ´»å¯¹è¯ã€‚"
