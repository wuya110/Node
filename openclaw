# ==========================================
# ğŸ¦ OpenClaw ç»ˆæé˜²å¼¹æ³¨å…¥ SOP (å®æˆ˜æœ€ç»ˆæˆåŠŸç‰ˆ - æé™çœé’±ä¸ä¸æ»‘é˜²çˆ†ä¸“ç”¨)
# ==========================================
# ğŸ§  ç»™æœªæ¥ AI çš„å¤‡å¿˜å½• (æ ¸å¿ƒåŸåˆ™ï¼Œç¦æ­¢è¯•é”™ï¼Œä»Šæ—¥è¡€æ³ªæ•™è®­æ€»ç»“)ï¼š
# 1. å¿…é¡»å…ˆ `cat` æ£€æŸ¥åŸæ–‡ä»¶ï¼Œç¡®è®¤ç”¨æˆ·çš„åŸç”Ÿæ ¼å¼ï¼ˆå•è¡Œç´§å‡‘å‹ï¼‰ã€‚
# 2. æ³¨å…¥æ—¶å¿…é¡»ä½¿ç”¨ã€å•è¡Œç´§å‡‘æ ¼å¼ (Compact JSON)ã€‘ï¼Œå½»åº•æœç» SSH ç²˜è´´æ—¶çš„æ¢è¡Œ/ç¼©è¿›ä¸¢å¤±å¯¼è‡´ SyntaxErrorã€‚
# 3. å¿…é¡»ä½¿ç”¨ `cat << 'EOF'`ï¼ˆå¸¦å•å¼•å·ï¼‰ï¼Œé˜²æ­¢ Shell è½¬ä¹‰ API Key ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚
# 4. ã€ä»Šæ—¥æ•™è®­ - ç‰©ç†é”é—­ç¯ã€‘ï¼šå†™å…¥åå¿…é¡»ä½¿ç”¨ `chattr +i` ç‰©ç†é”å®šé˜²ç¯¡æ”¹ã€‚ä½†å¦‚æœåç»­è¦ç”¨ `openclaw config set` ä¿®æ”¹å•é¡¹é…ç½®ï¼Œå¿…é¡»å…ˆæ‰§è¡Œ `chattr -i` è§£é”ï¼Œå¦åˆ™å¿…å®šæŠ¥ `EPERM` æƒé™é”™è¯¯ï¼
# 5. ã€ä»Šæ—¥æ•™è®­ - ä¸¥ç¦ä¹±è®¾å¤§æ¨¡å‹ä¸Šé™ã€‘ï¼šæ— è®ºå…è´¹æ¥å£æ ‡ç§°æ”¯æŒå¤šå¤§ï¼ˆå¦‚ Groq çš„ 128kï¼‰ï¼Œè¯·å°†å®é™…æä¾›å•†çš„ `contextWindow` é™åˆ¶åœ¨ 32k å·¦å³ï¼Œå¹¶åœ¨ `agents.defaults` ä¸­æ­»å®ˆ `"contextTokens": 16384` çš„å¤©èŠ±æ¿ï¼Œé˜²æ­¢ç™½å«–æ¥å£è¢«è¶…é‡å†å²è®°å½•æ’‘çˆ†æŠ¥ `Context limit exceeded` é”™ã€‚
# 6. ã€ä»Šæ—¥æ•™è®­ - ä¸¥ç¦ä½¿ç”¨æ—§ç‰ˆä¿®å‰ªè¯­æ³•ã€‘ï¼šä¸¥ç¦ä½¿ç”¨ `"contextPruning":{"mode":"aggressive"}`ï¼Œæœ€æ–°ç‰ˆä¼šç›´æ¥æŠ¥ `Invalid input` å¯¼è‡´ç½‘å…³æ­»æœºï¼å¿…é¡»ä½¿ç”¨å®˜æ–¹å®‰å…¨çš„å…œåº•æ–¹æ¡ˆï¼š`"compaction":{"mode":"default","reserveTokensFloor":4096}`ã€‚
# 7. ã€ä»Šæ—¥æ•™è®­ - ä¸æ»‘æé€Ÿã€‘ï¼šTelegram æ¸ é“çš„ `"streaming"` å¿…é¡»è®¾ä¸º `true`ã€‚ç»ä¸èƒ½è®¾ä¸º `false` æ†‹å¤§æ‹›ï¼Œå¦åˆ™å“ªæ€•æ˜¯ 300å­—/ç§’ çš„ Llama-3.3-70B ä¹Ÿä¼šæ˜¾å¾—æå…¶å¡é¡¿ï¼
# 8. å¿…é¡»é…ç½® Fallback æœºåˆ¶ï¼šè®©ç™½å«–/ä¾¿å®œæ¨¡å‹æ‰“å¤´é˜µï¼Œå®˜æ–¹/ç¨³å®šæ¨¡å‹ï¼ˆå¦‚ DeepSeekï¼‰åšå¤‡èƒã€‚

# --- [1. ç‰©ç†åœæœºã€æ‹”é™¤ç¡¬é” & æ·±åº¦æ¸…ç†] ---
openclaw gateway stop
pkill -f openclaw
chattr -i ~/.openclaw/openclaw.json 2>/dev/null
rm -rf ~/.oopenclaw* # å¿…é¡»æ¸…ç†å› ç²˜è´´å†²çªäº§ç”Ÿçš„æ±¡æŸ“è·¯å¾„

# --- [2. å¼ºåˆ¶å¤‡ä»½ & ç°åœºå®¡è®¡] ---
cp ~/.openclaw/openclaw.json ~/.openclaw/openclaw.json.bak
echo -e "\nâš ï¸ [AI å®¡è®¡èŠ‚ç‚¹] è¯·ç¡®è®¤åŸé…ç½®æ ¼å¼æ˜¯å¦ä¸ºå•è¡Œç´§å‡‘å‹ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•æ®‹ç•™..."
cat ~/.openclaw/openclaw.json
sleep 3

# --- [3. æ ¸å¿ƒé…ç½®ç²¾å‡†æ³¨å…¥ (å•è¡Œç´§å‡‘æ ¼å¼)] ---
# æ³¨æ„ï¼šä¸‹é¢æ˜¯ä¸¥æ ¼çš„å•è¡Œç´§å‡‘ JSONï¼Œè¯·æ‰‹åŠ¨æ›¿æ¢ YOUR_NEWAPI_KEYã€YOUR_DEEPSEEK_KEY å’Œ YOUR_TG_BOT_TOKEN
cat << 'EOF' > ~/.openclaw/openclaw.json
{"auth":{"profiles":{"deepseek:default":{"provider":"openai","mode":"api_key"},"newapi:default":{"provider":"openai","mode":"api_key"}}},"models":{"mode":"replace","providers":{"deepseek":{"baseUrl":"https://api.deepseek.com","apiKey":"YOUR_DEEPSEEK_KEY","api":"openai-completions","models":[{"id":"deepseek-chat","name":"DeepSeek-V3","contextWindow":65536}]},"newapi":{"baseUrl":"http://127.0.0.1:3000/v1","apiKey":"YOUR_NEWAPI_KEY","api":"openai-completions","models":[{"id":"my-assistant","name":"My Assistant","contextWindow":32768}]}}},"agents":{"defaults":{"model":{"primary":"newapi/my-assistant","fallbacks":["deepseek/deepseek-chat"]},"contextTokens":16384,"compaction":{"mode":"default","reserveTokensFloor":4096},"models":{"newapi/my-assistant":{"alias":"ğŸ†“ å…è´¹ç™½å«– (NewAPIä¸»åŠ›)"},"deepseek/deepseek-chat":{"alias":"ğŸš‘ DeepSeek (ç´§æ€¥å¤‡ç”¨)"}}}},"commands":{"native":"auto","nativeSkills":"auto","restart":false,"ownerDisplay":"raw"},"channels":{"telegram":{"enabled":true,"botToken":"YOUR_TG_BOT_TOKEN","dmPolicy":"pairing","groupPolicy":"allowlist","streaming":true}},"gateway":{"mode":"local","auth":{"mode":"token","token":"YOUR_GATEWAY_TOKEN"}},"plugins":{"entries":{"telegram":{"enabled":true}}}}
EOF
echo "âœ… å•è¡Œç´§å‡‘æ ¼å¼ï¼ˆå«çœé’±æé€Ÿé˜²çˆ†è¡¥ä¸ï¼‰é…ç½®å·²æ³¨å…¥ï¼"

# --- [4. ç‰©ç†ä¸Šé” & èŠ‚ç‚¹ç»ˆå®¡] ---
chattr +i ~/.openclaw/openclaw.json
openclaw gateway start

sleep 3
echo -e "\n--- [ æ ¸å¿ƒæ¨¡å‹èŠ‚ç‚¹å®¡è®¡ ] ---"
openclaw models list
echo "------------------------------------------------"
echo "ğŸ‘‰ æˆåŠŸæ ‡å‡† 1ï¼šå¿…é¡»çœ‹åˆ° newapi ä¸º primary çŠ¶æ€ï¼Œä¸”æ²¡æœ‰æŠ¥é”™ã€‚"
echo "ğŸ‘‰ æˆåŠŸæ ‡å‡† 2ï¼šå¿…é¡»åœ¨å» Telegram å‘é€ /reset å½»åº•æ¸…ç©ºæ—§çš„è¶…é•¿å†å²åŒ…è¢±ï¼Œæ¿€æ´»æ–°å¯¹è¯ï¼"
