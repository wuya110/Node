# ===============================
# OpenClaw DeepSeek ctx错误修复
# Error:
# Model context window too small (4096 tokens). Minimum is 16000
# ===============================


# 1. 停止服务
openclaw gateway stop
systemctl --user stop openclaw-gateway


# 2. 确认没有进程
ps aux | grep openclaw


# 3. 修改配置
nano ~/.openclaw/openclaw.json


# 4. 找到并修改为
"contextWindow": 128000,
"maxTokens": 128000


# 5. 启动服务
openclaw gateway start


# 6. 验证上下文
openclaw models list


# 正常应显示
# Ctx 125k 或 >=16000


# 7. 锁定配置（防止被覆盖）
chattr +i ~/.openclaw/openclaw.json


# 8. 验证锁定
lsattr ~/.openclaw/openclaw.json
# 应看到 ----i---------


# ===============================
# DeepSeek Custom Provider配置
# ===============================

API Base:
https://api.deepseek.com/v1

Model:
deepseek-chat

Compatibility:
OpenAI-compatible


# ===============================
# 如果需要解锁修改
# ===============================

chattr -i ~/.openclaw/openclaw.json


# ===============================
# 常见原因（仅供AI判断）
# ===============================

# Custom Provider 默认:
# contextWindow = 4096

# Agent要求:
# contextWindow >= 16000

# 症状:
# Telegram或Agent报:
# Model context window too small


# ===============================
# 验证服务状态
# ===============================

openclaw status
openclaw gateway status


# ===============================
# 日志排查
# ===============================

openclaw logs --follow
journalctl --user -u openclaw-gateway -n 100 --no-pager


# ===============================
# 完成标准
# ===============================

# openclaw models list 显示:
# custom-api-deepseek-com/deepseek-chat
# Ctx >= 16000

# Telegram可正常回复