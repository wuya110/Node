# ==========================================
# ğŸ¦ OpenClaw ç»ˆæé˜²å¼¹æ³¨å…¥ SOP (å®æˆ˜æ£€éªŒç‰ˆ)
# ==========================================

# --- [1. ç‰©ç†åœæœº & æ‹”é™¤ç¡¬é”] ---
# å¿…é¡»å…ˆåœç½‘å…³ï¼Œé˜²æ­¢åå°å®ˆæŠ¤è¿›ç¨‹åœ¨å’±ä»¬æ”¹æ–‡ä»¶æ—¶æŠ¢å å†™å…¥æƒ
openclaw gateway stop
pkill -f openclaw
chattr -i /root/.openclaw/openclaw.json 2>/dev/null

# --- [2. å¼ºåˆ¶å®‰å…¨å¿«ç…§ (åæ‚”è¯)] ---
# åœ¨åŠ¨æ‰‹å‰ç•™ä¸ªåº•ï¼Œå³ä¾¿æ”¹ç‚¸äº†ä¹Ÿèƒ½ç¬é—´ mv å›æ¥
cp /root/.openclaw/openclaw.json /root/.openclaw/openclaw.json.bak_stable
echo "âœ… å·²ç”Ÿæˆç¨³å¥å¤‡ä»½ï¼šopenclaw.json.bak_stable"

# --- [3. ç°åœºå®¡è®¡ (æŸ¥æ—§è´¦)] ---
# æ‰«ä¸€çœ¼åŸé…ç½®çš„å…³é”® ID å’Œç‰¹æ®Šè®¾ç½®ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°
cat /root/.openclaw/openclaw.json
echo -e "\nâš ï¸ è¯·ç¡®è®¤ä»¥ä¸Šæ—§é…ç½®æ— è¯¯ï¼Œå‡†å¤‡æ‰§è¡Œå…¨å®¶æ¡¶è¦†ç›–æ³¨å…¥..."
sleep 3

# --- [4. ç»ˆæå…¨å®¶æ¡¶æ³¨å…¥ (åŒæ ¸ä¿åº• + æ’ä»¶æ€»å¼€å…³)] ---
# ä½¿ç”¨ cat << 'EOF' è¯­æ³•ï¼Œå½»åº•æœç»å¼•å·è½¬ä¹‰é”™è¯¯ï¼Œå¹¶åŒ…å«æ‰€æœ‰æ ¸å¿ƒè¦ç´ 
cat << 'STABLE_EOF' > /root/.openclaw/openclaw.json
{
  "auth": {
    "profiles": {
      "deepseek:default": { "provider": "openai", "mode": "api_key" },
      "volcengine:default": { "provider": "openai", "mode": "api_key" }
    }
  },
  "models": {
    "mode": "replace",
    "providers": {
      "deepseek": {
        "baseUrl": "https://api.deepseek.com",
        "apiKey": "sk-85141fe6c96144b8884128993bf8a954",
        "api": "openai-completions",
        "models": [{"id": "deepseek-chat", "name": "DeepSeek-V3", "contextWindow": 128000}]
      },
      "volcengine": {
        "baseUrl": "https://ark.cn-beijing.volces.com/api/v3",
        "apiKey": "d62e38e6-5544-4818-b4cd-89554df38372",
        "api": "openai-completions",
        "models": [{"id": "ep-20260223003250-92xxg", "name": "Doubao-Pro", "contextWindow": 32768}]
      }
    }
  },
  "agents": {
    "defaults": {
      "model": { "primary": "deepseek/deepseek-chat" },
      "models": {
        "deepseek/deepseek-chat": { "alias": "ğŸ’ DeepSeek (å®˜æ–¹ç¨³å®šç‰ˆ)" },
        "volcengine/ep-20260223003250-92xxg": { "alias": "ğŸš€ è±†åŒ… (Pro å¤‡ç”¨ç‰ˆ)" }
      }
    }
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "8226030547:AAHqE0tgoux20xAGcKOIlMvB4h8M_AtFbyY",
      "dmPolicy": "pairing",
      "groupPolicy": "allowlist",
      "streaming": false
    }
  },
  "gateway": { "mode": "local" },
  "plugins": {
    "entries": {
      "telegram": { "enabled": true }
    }
  }
}
STABLE_EOF
echo "âœ… ç»ˆæå…¨å®¶æ¡¶é…ç½®å·²æ— ç¼æ³¨å…¥ï¼"

# --- [5. ç‰©ç†ä¸Šé” & é‡å¯ç…§å¦–é•œ] ---
# é”æ­»é…ç½®é˜²æ­¢è¢« Doctor ç¯¡æ”¹ï¼Œå¯åŠ¨ç½‘å…³å¹¶ç›´æ¥æŒ‚èµ·æ—¥å¿—è¿½è¸ª
chattr +i /root/.openclaw/openclaw.json
openclaw gateway start
sleep 2
echo "ğŸ¦ ç½‘å…³å·²å¯åŠ¨ï¼Œæ­£åœ¨è°ƒå‡ºç…§å¦–é•œ (å®æ—¶æ—¥å¿—)..."
echo "ğŸ‘‰ ç°åœ¨è¯·å» Telegram å‘é€ /reset ç„¶åæ‰“æ‹›å‘¼ï¼"
echo "------------------------------------------------"
openclaw logs --follow
